<div class="main-container">
  <section class="sidebar">
    <div class="profile-card">
      <% if current_user.avatar.present? %>
        <%= image_tag current_user.avatar.url %>
      <% else %>
        <img src="https://i.pinimg.com/originals/51/f6/fb/51f6fb256629fc755b8870c801092942.png">
      <% end %>
      <h1><%= current_user.name %></h1>
      <% unless current_user.bio == nil %>
        <p><%= current_user.bio %></p>
      <% end %>
    </div>

    <div class="recommended-card">
      <h1>Recommended</h1>
      <% @users.each do |user| %>
        <% unless current_user.id == user.id %>
          <p><%= user.name %></h3>
        <% end %>
      <% end %>
    </div>
  </section>
  <section class="main">
    <div class="new-tweet">
      <%= render 'form', post: @post %>
    </div>
    <% @posts.reverse_each do |post| %>
      <div class="post-card">
        <div class="post-user-container">
          <div class="post-user">
            <% if current_user.avatar.present? %>
              <%= image_tag current_user.avatar.url %>
            <% else %>
              <img src="https://i.pinimg.com/originals/51/f6/fb/51f6fb256629fc755b8870c801092942.png">
            <% end %>
            <div class="post-user-name">
              <p><%= post.user.name %></p>
              <p class="post-time"><%= post.created_at.strftime("%l:%M%p %d %b") %>
            </div>
          </div>
          <i class="fa fa-ellipsis-h"></i>
        </div>
        <p class="post-content"><%= post.content %></p>
        <div class="bottom-bar">
          <div class="like">
            <p class="like-count"><%= post.likes.length %></p>
            <% like_found = false %>
            <% post.likes.each do |like| %>
              <% if like.user.id == current_user.id %>
                <%= link_to '<i class="fas fa-heart unlike-button"></i>'.html_safe, like, method: :delete %>
                <% like_found = true %>
                <% break %>
              <% end %>
            <% end %>
            <%= render 'like', like: @like, post: post if !like_found%>
          </div>
          <%= link_to '<i class="fas fa-comment comment-button"></i>'.html_safe, post_path(post) %>
        </div>
      </div>
    <% end %>
  </section>
</div>

<table>
  <thead>
    <tr>
      <th>Content</th>
      <th>User</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @posts.each do |post| %>
      <tr>
        <td><%= post.content %></td>
        <td><%= post.user_id %></td>
        <td><%= link_to 'Show', post %></td>
        <% if post.user.id == current_user.id %>
          <td><%= link_to 'Edit', edit_post_path(post) %></td>
          <td><%= link_to 'Destroy', post, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Post', new_post_path %>

<script>
  var textarea = document.querySelector('textarea');

  textarea.addEventListener('keydown', autosize);
              
  function autosize(){
    var el = this;
    setTimeout(function(){
      el.style.cssText = 'height:auto; padding:0';
      // for box-sizing other than "content-box" use:
      // el.style.cssText = '-moz-box-sizing:content-box';
      el.style.cssText = 'height:' + el.scrollHeight + 'px';
    },0);
  }
</script>
